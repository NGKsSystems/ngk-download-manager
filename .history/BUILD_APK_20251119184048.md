# Building Android APK for NGK's Download Manager

## Overview
This guide explains how to build the Android APK from the mobile_app.py Kivy application using Buildozer.

## Prerequisites

### System Requirements
- **Linux** or **WSL (Windows Subsystem for Linux)** - Buildozer does NOT work on native Windows
- Python 3.8+ (Python 3.10 recommended)
- At least 5GB free disk space
- Internet connection for downloading Android SDK/NDK

### For Windows Users: Setup WSL2

1. **Install WSL2** (if not already installed):
```powershell
# Run in PowerShell as Administrator
wsl --install
```

2. **Install Ubuntu** (recommended):
```powershell
wsl --install -d Ubuntu-22.04
```

3. **Access your project in WSL**:
```bash
# In WSL terminal, navigate to your Windows files
cd /mnt/c/Users/suppo/Desktop/NGKsSystems/NGKs\ DL\ Manager/
```

## Installation Steps

### 1. Install System Dependencies (Ubuntu/Debian)

```bash
# Update package list
sudo apt update

# Install required packages
sudo apt install -y \
    python3-pip \
    build-essential \
    git \
    ffmpeg \
    libsdl2-dev \
    libsdl2-image-dev \
    libsdl2-mixer-dev \
    libsdl2-ttf-dev \
    libportmidi-dev \
    libswscale-dev \
    libavformat-dev \
    libavcodec-dev \
    zlib1g-dev \
    libgstreamer1.0-dev \
    gstreamer1.0-plugins-base \
    gstreamer1.0-plugins-good \
    openjdk-17-jdk \
    unzip \
    zip \
    autoconf \
    libtool \
    pkg-config \
    cmake \
    ninja-build
```

### 2. Install Cython and Buildozer

```bash
# Install Cython (required for building)
pip3 install --upgrade Cython==0.29.33

# Install Buildozer
pip3 install --upgrade buildozer

# Install additional Python build tools
pip3 install --upgrade setuptools wheel
```

### 3. Verify Java Installation

```bash
# Check Java version (should be 11 or higher)
java -version

# Set JAVA_HOME if needed
export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
echo 'export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64' >> ~/.bashrc
```

## Building the APK

### 1. Navigate to Project Directory

```bash
cd /mnt/c/Users/suppo/Desktop/NGKsSystems/NGKs\ DL\ Manager/
```

### 2. Initialize Buildozer (First Time Only)

This will download Android SDK, NDK, and other dependencies (~2GB):

```bash
# This creates .buildozer folder and downloads SDK/NDK
buildozer android debug
```

**Note:** First build takes 20-60 minutes depending on internet speed. Subsequent builds are much faster.

### 3. Build Debug APK

```bash
# Build debug APK (unsigned, for testing)
buildozer android debug
```

**APK Location:** `bin/ngkdownloader-1.0-arm64-v8a_armeabi-v7a-debug.apk`

### 4. Build Release APK (Optional)

For production release with signing:

```bash
# Build release APK
buildozer android release

# Sign the APK (requires keystore)
# Follow prompts to create keystore if needed
```

## Troubleshooting

### Build Fails with "SDK not found"

```bash
# Clean and rebuild
buildozer android clean
buildozer android debug
```

### Cython Version Issues

```bash
# Downgrade Cython if needed
pip3 install --upgrade Cython==0.29.33
```

### Permission Errors

```bash
# Give execute permissions to gradlew
chmod +x .buildozer/android/platform/build-*/dists/*/gradlew
```

### Out of Memory Errors

```bash
# Increase Java heap size in buildozer.spec
# Add to [app] section:
android.gradle_options = "-Xmx2048m"
```

### NDK/SDK Version Issues

Edit `buildozer.spec`:
```ini
android.api = 30
android.minapi = 21
android.ndk = 23b
android.sdk = 30
```

### Clean Build (Nuclear Option)

```bash
# Remove all build artifacts and start fresh
rm -rf .buildozer
buildozer android clean
buildozer android debug
```

## Testing the APK

### 1. Transfer APK to Android Device

**Via USB:**
```bash
# Enable USB debugging on your Android device
adb install bin/ngkdownloader-1.0-arm64-v8a_armeabi-v7a-debug.apk
```

**Via File Transfer:**
- Copy APK from `bin/` folder to your phone
- Install using file manager on Android

### 2. Grant Permissions

On first launch, the app will request:
- Storage permissions (required for downloads)
- Internet permissions (automatic)

### 3. Download Location

Downloads are saved to:
- `/storage/emulated/0/Download/` (Android external storage)

## Updating the APK

After making code changes to `mobile_app.py`:

```bash
# Rebuild APK
buildozer android debug

# Install updated APK (replaces previous version)
adb install -r bin/ngkdownloader-1.0-arm64-v8a_armeabi-v7a-debug.apk
```

## Build Configuration

Key settings in `buildozer.spec`:

```ini
[app]
title = NGK's Download Manager
package.name = ngkdownloader
package.domain = org.ngks.downloader
version = 1.0

# Python requirements (MUST match your imports)
requirements = python3,kivy,requests,yt-dlp,pillow,certifi,urllib3,charset-normalizer,idna,mutagen,websockets,brotli,pycryptodomex

# Android settings
android.api = 30
android.minapi = 21
orientation = portrait
android.enable_androidx = True
```

## Common Build Times

- **First build:** 20-60 minutes (downloads SDK/NDK)
- **Subsequent builds:** 5-15 minutes
- **Clean rebuild:** 10-20 minutes

## Android Studio Alternative (Advanced)

For more control:

1. **Generate Android project:**
```bash
buildozer android debug
```

2. **Open in Android Studio:**
- Open `.buildozer/android/platform/build-*/dists/ngkdownloader/`
- Build and debug through Android Studio

## Resources

- **Buildozer Docs:** https://buildozer.readthedocs.io/
- **Kivy for Android:** https://kivy.org/doc/stable/guide/android.html
- **Python for Android:** https://python-for-android.readthedocs.io/

## Quick Reference

```bash
# First time build
buildozer android debug

# Rebuild after code changes
buildozer android debug

# Clean build
buildozer android clean
buildozer android debug

# Install on device
adb install -r bin/*.apk

# View device logs (debugging)
adb logcat | grep python
```

## Verified Working Configuration

- **OS:** Ubuntu 22.04 (WSL2 on Windows)
- **Python:** 3.10.12
- **Cython:** 0.29.33
- **Buildozer:** 1.5.0
- **Android API:** 30
- **NDK:** 23b
- **Java:** OpenJDK 17

---

**Note:** Building APKs requires Linux/WSL. Native Windows builds are NOT supported by Buildozer.
